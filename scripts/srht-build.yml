image: debian/bullseye
packages:
- python3
- python3-pip
sources:
- https://git.sr.ht/~<user>/<project>
- https://git.sr.ht/~mrms/pak
environment:
  project: <project>
secrets:
- <your_secret>
shell: false
tasks:
- setup: |
    cd pak
    python3 -m pip install -r requirements.txt
    ./setup.py install --user
- build: |
    cd $project
    python3 -m pak build
- deploy: |
    cd $project
    set +x
    python3 -m pak upload -t `cat ../.secret` pak.tar
    python3 -m pak upload -t `cat ../.secret` pak.json
    set -x
